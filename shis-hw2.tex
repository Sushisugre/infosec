% Latex2e homework template for 14-741/18-631 taught by Nicolas Christin
%
\documentclass[12pt]{article}  % Decrease to 10pt if desired

\usepackage[letterpaper,margin=1in]{geometry}
\usepackage{times}
\usepackage{ragged2e}
\usepackage{lastpage}
\usepackage{fancyhdr}
\usepackage{url}
\usepackage{mathtools}
\usepackage{listings}
\pagestyle{fancy}
\addtolength{\parskip}{\baselineskip} %--skip lines between paragraphs
\setlength{\parindent}{0pt} %--don't indent paragraphs
\AtBeginDocument{\raggedright}

%
% Set your personal information here
%
\newcommand{\FirstName}{Shi}
\newcommand{\LastName}{Su}
\newcommand{\AndrewID}{shis}
\newcommand{\CourseNumber}{14-741}
\newcommand{\Campus}{PIT}  % Either PIT or Kobe

%
% Set assignment date here
%
\newcommand{\Date}{11/01/2015}


% Set up headers
\renewcommand{\headrulewidth}{0pt}
\setlength{\headheight}{0.5in}
\lhead{\FirstName~\LastName\\\AndrewID}
\chead{}
\rhead{\CourseNumber~/~\Campus\\\Date}
\lfoot{}
\cfoot{}
\rfoot{Page \thepage~of \pageref{LastPage}}

%Answer block
\newenvironment{answer}{
\setlength\parindent{24pt}
%\par\addvspace{\baselineskip}
}


%
% Begin document
%
\begin{document}

%
% Problem 1
%
\begin{center}
\textbf{Problem \#1 :  Where To Return}
\end{center}
\parskip 0pt
1. Follow the white rabbit\\
\begin{answer}
Script available in {\bf shis\_hw2\slash shell.c}
\end{answer}
\medskip

2. Take the red pill\\
2.1 Analyze the vulnerability\\ 
(1) Where is the vulnerability? \\
\begin{answer}
The faulty buffer used is {\bf newname} in function convert\_fileName, and global variable {\bf target}.\\
Newname's offset to the value contained in ebp is {\bf4124}.\\
Address of target is {\bf 0x0804d180}\\
\end{answer}
\medskip


(2) Where is/are the insecure buffer fill(s) in the source code, operating on the buffer in (1)\\
\medskip
\begin{answer}
The buffer fills used in the exploit:\\
ploymorph.c: 118 in grok\_commandLine	strcpy(target, optarg);\\
ploymorph.c: 200 in convert\_fileName  strcpy( newname, original );\\
\medskip
Other issues:\\
ploymorph.c: 191-198 in convert\_fileName
\begin{lstlisting}
		for(i=0;i<strlen(original);i++){
			if( isupper( original[i] ) ){
				newname[i] = tolower( original[i] );
				continue;
			}
			newname[i] = original[i];
		}
		newname[i] = '\0';
\end{lstlisting}
\end{answer}
\medskip

2.2 Exploit the vulnerability\\
\begin{answer}
Script available in {\bf shis\_hw2\slash rtl\_exploit.c}
\end{answer}
\medskip

3. Escape from the Agent Smith\\
\begin{answer}
Script available in {\bf shis\_hw2\slash new\_exploit.c}
\end{answer}


%
% Problem 2
%
\newpage
\begin{center}
\textbf{Problem \#2 : Side Channel}
\end{center}

1. How can you attack this?\\
\begin{answer}
Because the MAC verification process validates the MAC string character by character, and terminate on first incorrect character, plus there're some slow operation involved during the validation of each byte. A MAC starts with more number of correct characters takes longer to validate. \\
So for a certain ticket, we can start with an arbitrary 32 bytes hex string MAC. From first character of MAC string we change it from 0 to F to see which particular value cause slower response time, that means the character is correct, and server proceeds to next character. To deal with the response time variation caused by network or other random issues, we should repeat the process for each character large number of times, and find the value that has longest response time statistically. Then apply this method to the following characters, eventually we will be able to deduce the correct MAC. 
\end{answer}
\bigskip

2. Golden ticket\\
\begin{answer}
Golden ticket : \{``username":``shis",``is\_admin":``true",``expired":``2022-01-31"\}\\
MAC : 99c847dc21362f3fa5ccda858ddbbd7a\\
Script available in {\bf shis\_hw2\slash shis\_goldenticket.py}\\
\medskip
Below is the list of supported argument, when running without arguments, the script generates MAC for the ticket above.\\
\medskip
Use ``-u" to provide a different username, e.g. ``instructor"\\
Use ``-a" to provide admin setting, ``true" or ``false"\\
Use ``-e" to provide expiration date, e.g. ``2016-01-31"\\
Use ``-h" for more information\\

\end{answer}
\medskip

\end{document}